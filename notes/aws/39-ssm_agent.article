AWS SSM agent
|| Last update: 7 Feb 2020





This is the role you need to use SSM on a node:

    data "aws_partition" "current" {}

    resource "aws_iam_role_policy_attachment" "ssm_policy_att" {
      role       = aws_iam_role.my_role.name
      policy_arn = "arn:${data.aws_partition.current.partition}:iam::aws:policy/service-role/AmazonEC2RoleforSSM"
    }

We tried to investigate a way to monitor when a node SSM agent lose contact with their control plane and become unavailable, but AWS support confirms there is no metrics on cloudwatch for it:

[…] I understand that you would like to keep a metric of SSM agent PingStatus. There is no turnkey solution for this so it has be scripted by calling ssm:DescribeInstanceInformation API, parse the responses and then publish the metric to CloudWatch. […] Creates a CloudWatch alarm that notifies an SNS topic when the SSM agent status goes into ConnectionLost.

Due to the lack of bandwidth we are not implementing this.
